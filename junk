version 2 


param(
    [string]$folder,
    [string]$fileExtension = "*",
    [string]$oldWord,
    [string]$newWord,
    [string]$skipWord
)

$skipWordRegex = [regex]::Escape($skipWord)

Get-ChildItem $folder -Recurse -Include "*.$fileExtension" | ForEach-Object {
    $file = $_.FullName
    $lines = Get-Content $file
    $updatedLines = @()
    $fileUpdated = $false

    foreach($line in $lines) {
        if ($line -match $oldWord -and !($line -match $skipWordRegex)) {
            $updatedLine = $line -replace "(?i)$oldWord", $newWord
            $updatedLines += $updatedLine
            $fileUpdated = $true
        }
        else {
            $updatedLines += $line
        }
    }

    if ($fileUpdated) {
        $updatedLines | Set-Content $file
    }
    else {
        $lines | Set-Content $file
    }
}




.\ReplaceTextInFiles.ps1 -Directory "C:\Test" -FileExtension "*.txt" -OldWord "old" -NewWord "new" -SkipWord "skip" -SkipSubfolder "C:\Test\Subfolder"



#############
param (
   [string]$Directory = ".",
   [string]$FileExtension = "*.txt",
   [string]$OldWord,
   [string]$NewWord,
   [string]$SkipWord,
   [string]$SkipSubfolder
)

$counter = 0

Get-ChildItem -Path $Directory -Filter $FileExtension -Recurse | Where-Object { $_.FullName -notmatch [regex]::Escape($SkipSubfolder) } | ForEach-Object {
   $file = $_.FullName
   $fileContent = Get-Content $file
   $newFileContent = @()
   $fileContent | ForEach-Object {
      $line = $_
      if ($line -notmatch $SkipWord) {
         $line = $line -creplace [regex]::Escape($OldWord), $NewWord
      }
      $newFileContent += $line
   }
   $newFileContent = $newFileContent -replace "`r`n$", "`r`n"
   Set-Content $file $newFileContent
   $counter++
}

Write-Host "$counter files were updated."


.\replace-word.ps1 -Directory "C:\ExampleFolder" -FileExtension "*.txt" -OldWord "Hello" -NewWord "Hi" -SkipWord "(comment)" -SkipSubfolder "C:\ExampleFolder\Archive"
