version 2 

param ($directory, $fileExtensions, $wordToReplace, $newWord, $skipWord)

Get-ChildItem -Path $directory -Recurse -Include $fileExtensions | ForEach-Object {
    $file = $_.FullName
    $content = Get-Content $file
    if ($content -match $wordToReplace) {
        $newContent = ""
        $lineCount = 0
        $content | ForEach-Object {
            $line = $_
            if ($line -notmatch $skipWord) {
                $line = $line -replace $wordToReplace, $newWord, `
                    ([System.Text.RegularExpressions.RegexOptions]::IgnoreCase)
            }
            $newContent += $line + [Environment]::NewLine
            $lineCount++
        }
        if ($lineCount -gt 0) {
            $newContent = $newContent.TrimEnd([Environment]::NewLine)
        }
        Set-Content $file $newContent
    }
}

.\replace-word.ps1 -directory "C:\Test" -fileExtensions "*.txt" -wordToReplace "old" -newWord "new" -skipWord "skip"


#############
param (
   [string]$Directory = ".",
   [string]$FileExtension = "*.txt",
   [string]$OldWord,
   [string]$NewWord,
   [string]$SkipWord,
   [string]$SkipSubfolder
)

$counter = 0

Get-ChildItem -Path $Directory -Filter $FileExtension -Recurse | Where-Object { $_.FullName -notmatch [regex]::Escape($SkipSubfolder) } | ForEach-Object {
   $file = $_.FullName
   $fileContent = Get-Content $file
   $newFileContent = @()
   $fileContent | ForEach-Object {
      $line = $_
      if ($line -notmatch $SkipWord) {
         $line = $line -creplace [regex]::Escape($OldWord), $NewWord
      }
      $newFileContent += $line
   }
   $newFileContent = $newFileContent -replace "`r`n$", "`r`n"
   Set-Content $file $newFileContent
   $counter++
}

Write-Host "$counter files were updated."


.\replace-word.ps1 -Directory "C:\ExampleFolder" -FileExtension "*.txt" -OldWord "Hello" -NewWord "Hi" -SkipWord "(comment)" -SkipSubfolder "C:\ExampleFolder\Archive"
